<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>USF Athletics</title>


<meta name="viewport" content="width=device-width, user-scalable=noinitial-scale=1"/>
<link rel="stylesheet" href="styles.css" />
<link rel="stylesheet" href="jquery.mobile.structure-1.2.0.min.css">
<link rel="stylesheet" href="jquery.mobile-1.4.0.min.css" />
<script src="jquery-1.9.1.min.js"></script>
<script src="jquery.mobile-1.4.0.min.js"></script>


</head>
<!--<script> document.addEventListener("deviceready", onDeviceReady, false);</script>
<script>  function onDeviceReady() {
                                                          
      
    }</script>-->
<style type="text/css">
* {
    -webkit-touch-callout: none;
    -webkit-user-select: none; /* Disable selection/copy in UIWebView */
}
</style>
<style>

.in, .out {
    -webkit-animation-timing-function: ease-in-out;
    -webkit-animation-duration: 15ms;
}
</style>
<body style="background-color:#472d16;" onload="getAjax();">
<div data-role="page" data-shadow="false" id ="homepage" style="background-color:#edb12d;" >
<div data-role="header" style="width:100%;margin-left:-20px;margin-right:-20px;padding-left:20px;padding-right:20px;position:fixed;top:0;left:0;border:0;margin-top:-2%;background-color:#edb12e;box-shadow:2.5px 0px 30px #403f3f;" >
    </br>
    	<img src="img/header1.jpg" width="100%" id="headerpic" height="50%"  alt="" style="padding-right:50%;float:left;margin-left:0;margin-top:-6.5%;">
</div>
<div data-role="content" style="background-color:#edb12d;padding-top:-1%;margin-top:36.5%;">

<script src="kyle.js"></script>
<script src="localdb_news.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova_plugins.js"></script>
<script src="js/aws-sdk-2.0.0-rc.14.min.js"></script>
<script>
var pushNotification;
document.addEventListener("deviceready", function(){
	pushNotification = window.plugins.pushNotification;
}); 

AWS.config.accessKeyId = 'AKIAJEHNHKQZ67D36V5A';
AWS.config.secretAccessKey = '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';
AWS.config.region = 'us-east-1';
var sns = new AWS.SNS();		

window.setTimeout(function(){
	if (device.platform == 'android' || device.platform == 'Android' || device.platform == 'amazon-fireos' ) {
			pushNotification.register(successHandler, errorHandler, {"senderID":"1090696343696","ecb":"onNotification"});		// 
		} 
		else {
			console.log("TRYING TO REGISTER FOR PUSH");
			pushNotification.register(tokenHandler, errorHandler, {"badge":"true","sound":"true","alert":"true","ecb":"onNotificationAPN"});	
	}
},7000);

function tokenHandler (result) {
   console.log("TOKEN");
   alert(result);
    var params = {
	  PlatformApplicationArn: 'arn:aws:sns:us-east-1:370339223087:app/APNS_SANDBOX/USF_Athletics', // required
	  Token: result // required
	};
	sns.createPlatformEndpoint(params, function(err, data) {
					  if (err) {
						  console.log("CAN'T CREATE PLATFORM ENDPOINT");
						  console.log(err, err.stack);
						  } 
					  else{
						  localStorage["ARN"] = data.EndpointArn;
						  var subscriptionObject = {
							  Protocol: 'application',
							  TopicArn: 'arn:aws:sns:us-east-1:370339223087:USFAthletics_PushNotifications',
							  Endpoint: data.EndpointArn
							  };
						  sns.subscribe(subscriptionObject, function(err, data){
							  if(err){
								  console.log("CAN'T SUBSCRIBE");
								  console.log(err);
								  }
							  });
					  }
	});
}

function errorHandler (error) {
	alert(error);
}
				

$.ajaxSetup ({
// Disable caching of AJAX responses
cache: false
});

init();
/*
	This function retrieves the latest news for 8 sports.
*/
function getAjax(){
		
		var content = document.getElementById("content");
	
		var output = "";
		
		kyle.getNews(
		{
			
			success: function(json)
			{
				console.log(json);
				var oid = localStorage["news_id"];
				
				 for(var i = 0;i<json.length;i++){
					 
					var title = json[i]["Title"];
					var articleBody = json[i]["Body"];
					var articleSport = json[i]["Sport"];
					switch(json[i]["Sport"]){
						case '1':
						articleSport = "Men's Basketball";
						break;
						case '5':	
						articleSport = "Football";
						break;
						case '3':
						articleSport = "Baseball";
						break;
						case '2':
						articleSport = "Women's Basketball";
						break;
						case '7':
						articleSport = "Men's Soccer";
						break;
						case '14':
						articleSport = "Women's Soccer";
						break;
						case '11':
						articleSport = "Softball";
						break;
						case '18':
						articleSport = "Volleyball";
						break;
						}
					
					var picLink = json[i]["Photo_url"];
					var picCaption= json[i]["Photo_caption"];
					output += "<tr onclick='showNews(this.id)' id='"+ json[i].ID +"' style='padding-top:-20px;'class='news'><td id='"+ json[i].ID +"' style='padding-left:6%;padding-bottom:0%;padding-top:0%;background-color:#edb12d; font-family:superclare;font-size:14px;text-shadow:none;color:white; width:100%; height:4%;border-bottom:40px #FFFFFF;text-overflow: ellipsis;'><p style='text-overflow: ellipsis;white-space:nowrap;'>" + title + "</p></td></a></tr>";
					//alert(output);
				
					localStorage["output"]=output;
					addNews(title,articleBody,articleSport,picLink,picCaption);
					
				
					//addNews(title,articleBody,articleSport,picLink,picCaption);
				// alert(JSON.stringify(json));
				// alert(typeof(json[0].ID));
				
				
				 
				 }
				
				 var outputting = document.getElementById('news');
		   		 outputting.innerHTML = localStorage["output"];
			},
			error: function()
			{
				alert("Failed To Retrieve News Articles");
			}
		});
		}
	
</script>
<script>
          getAjax();
		  
/*
	This function takes in an id based upon the table row that
	was tapped and then changes the page to display that news
	article.
*/

function showNews(id){
						localStorage["news_id"] = id;
						//$.mobile.changePage('getNews.html', { transition: 'pop', role: 'dialog'});
						$(':mobile-pagecontainer').pagecontainer( "change", "getNews.html", { role: "dialog" });

					}
</script>   
<div id="newsHolder" style="overflow-x:hidden;overflow-y:scroll;width:127%;margin-left:-9%;height:370px;">
<table style="margin-left:0%;width:127%;width:100%;font-size:20px;margin-top:-4%;background-color:#453120" id="news">
                  
</table>

<div data-role="footer" style="border:0;background-color:#472d16;">
<footer style="bottom:0;left:0;margin-top:135.9%;position:fixed;width:100%;background-color:#edb12e;box-shadow:2.5px 0px 30px #403f3f;">
    
      <a href="rosters.html" data-transition="slide"><img src="img/roster.jpg" width=20% style="float:left;clear:right;padding-left:6%;"></a>
      <a href="gymschedule.html" data-transition="slide"><img src="img/info.jpg" width=20%  style="float:left;clear:right;padding-left:3%;"></a>
      <a href="calendar.html" data-transition="slide"><img src="img/schedule.jpg" width=20%  style="float:left;clear:right;padding-left:5%;"></a>
     <a href="livestats.html" data-transition="slide"><img src="img/livestats.jpg" width=20% style="float:left;clear:right;padding-left:3%;"></a>
</footer>
</div>
</div>
</body>
</html>
